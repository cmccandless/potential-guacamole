Test for race condition courtesy of @mRcfps
